<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	lang="vi">
<head th:replace="fragments/html-head">
<meta charset="utf-8">
<title>Thêm mới đại lý</title>
</head>

<body>
	<div class="wrapper">
		<!-- Sidebar  -->
		<nav id="sidebar" th:replace="fragments/sidebar"></nav>

		<!-- Page Content  -->
		<div id="content">
			<div class="div-navbar" th:replace="fragments/div-navbar"></div>

			<div class="container-fluid ">
				<div class="heading">
					<h3>QUẢN LÝ TÀI KHOẢN NGÂN HÀNG ĐẠI LÝ</h3>
				</div>
				<div class="box box-primary">
					<div class="tab-content">
						<form>
							<table class="table table-condensed col">
								<tr>
									<td><label for="agencyArea">Công ty khu vực</label>
										<select name="agencyArea" id="agencyArea" class="form-control" th:if="${#lists.size(agencyArea) >= 2}">
											<option value="">--Chọn công ty khu vực--</option>
											<option th:each="ag : ${agencyArea}" th:value="${ag.areaId}" th:text="${ag.areaName}"></option>
										</select>
										<select name="agencyArea" id="agencyArea" class="form-control" th:if="${#lists.size(agencyArea) < 2}">
											<option th:each="ag : ${agencyArea}" th:value="${ag.areaId}" th:text="${ag.areaName}"></option>
										</select>
									</td>
									<td style="width: 50%;"><label for="agencyId">Đại lý</label>
										<select name="agencyId" id="agencyId"  class="form-control" th:if="${agency} != null">
											<option th:each="ag : ${agency}" th:value="${ag.id}" th:text="${ag.agencyName}" ></option>
										</select>
										<select name="agencyId" id="agencyId"  class="form-control" th:if="${agency} == null">
											<option value="">--Chọn đại lý--</option>
										</select>
									</td>
								</tr>
								<tr class='control'>
									<td colspan='4' align='center'>
										<button type="button" class="btn btn-primary button-control"
											name="doSearch" id="doSearch">
											<i class="fa fa-search"></i> Tìm kiếm
										</button>
										<button type="button" class="btn btn-primary button-control"
										id="doNew" data-target="#modal-command-type-create"> <i
											class="fa fa-plus-square"></i> Thêm mới
									</button>
									</td>
								</tr>
							</table>
						</form>
						<div class="list-bank-agency box box-primary">
							<table class="table table-bordered">
								<thead>
									<tr align="center">
										<th>Tên đại lý</th>
										<th>Số tài khoản</th>
										<th>Tên ngân hàng</th>
										<th>Chi nhánh</th>
										<th>Địa chỉ</th>
										<th>Ngày tạo</th>
										<th>Ngày cấp nhập</th>
										<th>Hành động</th>
									</tr>
								</thead>
								<tbody id="tableBody"></tbody>
							</table>
							<nav>
								<ul class="pagination">
									<li class="page-item"><span id="totalPage"></span></li>
									<li class="page-item"><span id="pageSize"></span></li>
									<li class="page-item">
										<div class="form-group">
											<select class="form-control" name="selector"
												onChange="resetPage()">
												<option>10</option>
												<option>20</option>
												<option>50</option>
												<option>100</option>
												<option>200</option>
											</select>
										</div>
									</li>
									<li class="page-item"><span>&nbsp;</span></li>
									<li class="page-item"><a class="page-link"
										onClick="firstPage()"><i class="fa fa-angle-double-left"></i></a></li>
									<li class="page-item"><a class="page-link"
										onClick="prevPage()"><i class="fa fa-angle-left"></i></a></li>
									<li class="page-item"><a id="prePage"></a></li>
									<li class="page-item"><a class="page-link"
										id="currentPage">1</a></li>
									<li class="page-item"><a id="nexPage"></a></li>
									<li class="page-item"><a class="page-link"
										onClick="nextPage()"><i class="fa fa-angle-right"></i></a></li>
									<li class="page-item"><a class="page-link"
										onClick="lastPage()"><i class="fa fa-angle-double-right"></i></a></li>
								</ul>
							</nav>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--modal form create-->
	<div class="modal fade in" id="modal-command-type-create" style="display: none;"  data-backdrop="static" data-keyboard="false" >
		<div class="modal-dialog modal-xl overflow-auto">
			<div class="modal-content">
				<div class="modal-header bg-yellow" style="display: flex;">
					<div class="title">
						<h4 class="modal-title">THÊM MỚI NGÂN HÀNG ĐẠI LÝ</h4>
					</div>
					<button type="button" data-dismiss="modal" class="close" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="create_table">

				</div>
				<div class="modal-footer" style="text-align: center;">
				</div>
			</div>

		</div>
	</div>

	<!--modal form edit-->
	<div class="modal fade in" id="modal-command-type-edit" style="display: none;"  data-backdrop="static" data-keyboard="false" >
		<div class="modal-dialog modal-xl overflow-auto" style="width: 100%; margin-top: 50px;">
			<div class="modal-content">
				<div class="modal-header bg-yellow" style="display: flex;">
					<div class="title"><h4 class="modal-title" id="modal-title-edit"></h4></div>
					<button type="button" data-dismiss="modal" class="close" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" id="edit_table">

				</div>
				<div class="modal-footer" style="text-align: center;">
				</div>
			</div>
		</div>
	</div>

	<script src="/vasonline/js/select2.min.js"></script>
	<script src="/vasonline/js/custom_service.js"></script>
	<script src="/vasonline/js/bank-account-search.js"></script>
	<script type="text/javascript">
		let agencyId = localStorage.getItem("agencyId");
		let areaId = localStorage.getItem("areaId");
		function messageSuccess(){
			toastr.success('Thành công');
		}
		function messageFailed(){
			toastr.error('Thất bại');
		}
		$(document).ready(function() {
			$('#sidebarCollapse').on('click', function() {
				$('#sidebar').toggleClass('active');
			});

			let messageResponse = '[[${message}]]';
			if(messageResponse == 'success'){
				messageSuccess();
			}
			if (messageResponse == 'failed'){
				messageFailed();
			}
			if(areaId != null){
				$("#agencyArea").val(areaId);
			}
			if ($("#agencyArea").val() != '' && $("#agencyId").val() == ''){
				var linkPost = "/vasonline/agency-list?idAgencyArea=" + $("#agencyArea").val();
				$.ajax({
					url: linkPost,
					method: 'GET',
					success: function (data) {

						var str = '<option value="">--Chọn đại lý--</option>';

						for (let i = 0; i < data.length; i++) {
							str += ' <option value= "' + data[i].id + '" >' + data[i].agencyName + '</option>'
						}
						$('#agencyId').html(str);
					},
					error: function (request) {
						alert("The request failed: " + request.responseText);
					}
				});
			}


			// if(agencyId != null){
			// 	// $("#agencyArea").val(areaId);
			// 	$("#agencyId").val(agencyId);
			// }
			if(areaId != null && $("#agencyId").val() == ''){
				console.log(areaId);
				var linkPost = "/vasonline/agency-list?idAgencyArea=" + areaId;
				$.ajax({
					url: linkPost,
					method: 'GET',
					success: function (data) {
						var str = '<option value="">--Chọn đại lý--</option>';

						for (let i = 0; i < data.length; i++) {
							if(data[i].id == agencyId){
								str += ' <option value= "' + data[i].id + '" selected >' + data[i].agencyName + '</option>'
							}else {
								str += ' <option value= "' + data[i].id + '" >' + data[i].agencyName + '</option>'
							}
						}
						$('#agencyId').html(str);
						//$("#agencyId").val(agencyId);
					},
					error: function (request) {
						alert("The request failed: " + request.responseText);
					}
				});
			}
		});
		$("#agencyArea").on("change", function (e) {
			// if (areaId == null){
				var linkPost = "/vasonline/agency-list?idAgencyArea=" + $("#agencyArea").val();

				$.ajax({
					url: linkPost,
					method: 'GET',
					success: function (data) {

						var str = '<option value="">--Chọn đại lý--</option>';

						for (let i = 0; i < data.length; i++) {
							str += ' <option value= "' + data[i].id + '" >' + data[i].agencyName + '</option>'
						}
						$('#agencyId').html(str);

					},
					error: function (request) {
						alert("The request failed: " + request.responseText);
					}
				});
			// }
		})
		$(function() {
			$("#doSearch").click();
			localStorage.removeItem("agencyId");
			localStorage.removeItem("areaId");
		});
	</script>
</body>

</html>