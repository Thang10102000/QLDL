<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      lang="vi">
<head th:replace="fragments/html-head">
    <meta charset="utf-8">
    <title>Tra cứu thông tin bảo lãnh đặt cọc</title>
</head>

<body>
<div class="wrapper">
    <!-- Sidebar  -->
    <nav id="sidebar" th:replace="fragments/sidebar"></nav>

    <!-- Page Content  -->
    <div id="content">
        <div class="div-navbar" th:replace="fragments/div-navbar"></div>

        <div class="container-fluid ">
            <div class="heading">
                <h3>TRA CỨU THÔNG TIN BẢO LÃNH - ĐẶT CỌC</h3>
            </div>
            <div class="box box-primary">
                <form>
                    <table class="table table-condensed col">
                        <tr>
                            <td style="width: 50%">
                                <label for="areaIdSearch">Công ty khu vực</label>
                                <select name="areaIdSearch" id="areaIdSearch" class="form-control" th:if="${#lists.size(agencyArea) >= 2}">
                                    <option value="">--Chọn công ty khu vực--</option>
                                    <option th:each="j : ${agencyArea}"
                                            th:value="${j.areaId}" th:text="${j.areaName}" ></option>
                                </select>
                                <select name="areaIdSearch" id="areaIdSearch" class="form-control" th:if="${#lists.size(agencyArea) < 2}">
                                    <option th:each="j : ${agencyArea}"
                                            th:value="${j.areaId}" th:text="${j.areaName}" ></option>
                                </select>
                                <span id="areaId_msg"></span>
                            </td>
                            <td style="width: 50%"><label for="agencyNameSearch">Đại lý</label>
                                <select name="agencyNameSearch" id="agencyNameSearch" class="form-control" th:if="${agency} == null">
                                    <option value="">--Chọn đại lý--</option>
                                </select>
                                <select name="agencyNameSearch" id="agencyNameSearch" class="form-control" th:if="${agency} != null">
                                    <option th:each="i : ${agency}" th:value="${i.id}" th:text="${i.agencyName}"></option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td><label for="startDateSearch">Ngày bắt đầu</label> <input
                                    type="text" name="startDateSearch" class="form-control" id="startDateSearch" autocomplete="off" /></td>
                            <td><label for="endDateSearch">Ngày kết thúc</label> <input
                                    type="text" name="endDateSearch" class="form-control" id="endDateSearch" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td><label for="depositeAmountSearch">Số tiền bảo lãnh</label> <input
                                    type="number" name="depositeAmountSearch" class="form-control"
                                    id="depositeAmountSearch" autocomplete="off"></td>
                            <td><label for="statusSearch">Trạng thái</label> <select
                                    name="statusSearch" id="statusSearch" class="form-control">
                                <option value="">--Chọn trạng thái--</option>
                                <option value="1">Hiệu lực</option>
                                <option value="0">Không hiệu lực</option>
                            </select></td>
                        </tr>
                        <tr class='control'>
                            <td colspan='4' align='center'>
                                <button type="button" class="btn btn-primary button-control"
                                        name="doSearch" id="doSearch">
                                    <i class="fa fa-search"></i> Tìm kiếm
                                </button>&nbsp;
                                <button type="button" class="btn btn-primary button-control"
                                        name="export" id="export">
                                    <i class="fa fa-file-excel-o"></i> Kết xuất
                                </button>&nbsp;
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
            <div class="list-service box box-primary">
                <table class="table table-bordered" id="listData">
                    <thead>
                    <tr align="center">
                        <th>Tên đại lý</th>
                        <th>Số tiền bảo lãnh (VNĐ)</th>
                        <th>Ngày bắt đầu</th>
                        <th>Ngày kết thúc</th>
                        <th>Trạng thái</th>
                    </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        <li class="page-item"><span id="totalPage"></span></li>
                        <li class="page-item"><span id="pageSize"></span></li>
                        <li class="page-item">
                            <div class="form-group">
                                <select class="form-control" name="selector"
                                        onChange="resetPage()">
                                    <option>10</option>
                                    <option>20</option>
                                    <option>50</option>
                                    <option>100</option>
                                    <option>200</option>
                                </select>
                            </div>
                        </li>
                        <li class="page-item"><span>&nbsp;</span></li>
                        <li class="page-item"><a class="page-link"
                                                 onClick="firstPage()"><i class="fa fa-angle-double-left"></i></a></li>
                        <li class="page-item"><a class="page-link"
                                                 onClick="prevPage()"><i class="fa fa-angle-left"></i></a></li>
                        <li class="page-item"><a id="prePage"></a></li>
                        <li class="page-item"><a class="page-link" id="currentPage">1</a></li>
                        <li class="page-item"><a id="nexPage"></a></li>
                        <li class="page-item"><a class="page-link"
                                                 onClick="nextPage()"><i class="fa fa-angle-right"></i></a></li>
                        <li class="page-item"><a class="page-link"
                                                 onClick="lastPage()"><i class="fa fa-angle-double-right"></i></a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<script src="/vasonline/js/select2.min.js"></script>
<script src="/vasonline/js/bootstrap-datepicker.min.js"></script>
<script src="/vasonline/js/custom_service.js"></script>
<script src="/vasonline/js/search-export-deposit.js"></script>
<script type="text/javascript">
    $(function() {
        $(document).ready(function () {
            $("#startDateSearch").datepicker({ format: "dd/mm/yyyy",todayHighlight: true})
            $("#endDateSearch").datepicker({ format: "dd/mm/yyyy",todayHighlight: true});
            if ($("#areaIdSearch").val() != null && $("#agencyNameSearch") == ''){
                var linkPost = "/vasonline/agency-list?idAgencyArea=" + $("#areaIdSearch").val();
                $.ajax({
                    url: linkPost,
                    method: 'GET',
                    success: function (data) {
                        var str = '<option value="">--Chọn đại lý--</option>';
                        for (let i = 0; i < data.length; i++) {
                            str += '<option value= "' + data[i].id + '" >' + data[i].agencyName + '</option>'
                        }
                        $('#agencyNameSearch').html(str);
                    },
                    error: function (request) {
                        alert("The request failed: " + request.responseText);
                    }
                });
            }
            $("#areaIdSearch").on("change", function (e) {
                let value = Array.from(e.target.selectedOptions, option => option.value);
                // $('input:hidden[name=brand]').val(value);
                var linkPost = "/vasonline/agency-list?idAgencyArea=" + value;

                $.ajax({
                    url: linkPost,
                    method: 'GET',
                    success: function (data) {

                        var str = '<option value="">--Chọn đại lý--</option>';

                        for (let i = 0; i < data.length; i++) {
                            str += '<option value= "' + data[i].id + '" >' + data[i].agencyName + '</option>'
                        }
                        $('#agencyNameSearch').html(str);

                    },
                    error: function (request) {
                        alert("The request failed: " + request.responseText);
                    }
                });
            })
        });
        $(function () {
            $("#doSearch").click();
        });
    })
</script>
</body>

</html>