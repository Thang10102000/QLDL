<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:func="http://telsoft.com.vn/functions"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:o="http://omnifaces.org/ui">
<h:head>
</h:head>
<h:body>
    <ui:composition>
        <div class="ui-fluid">
            <h:panelGroup id="panel_center">
                <p:panel header="#{PP_LOGCHANGE.filter_option}" styleClass="box-primary">
                    <h:panelGroup id="panel_filter_options" layout="grid" columns="6" styleClass="ui-panelgrid-blank">
                        <div class="ui-g">
                            <!--                            SELECT NAME REPORT -->
                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <div class="ui-material">
                                    <p:outputLabel for="name" value="#{PP_APPROVEDOCUMENT.name}"/>
                                    <p:inputText id="name" value="#{approveDocumentController.mName}">

                                    </p:inputText>
                                    <p:message for="name"/>
                                </div>
                            </div>

<!--                            SELECT PARTNER -->
<!--                            <div class="ui-g-12 ui-md-6 ui-lg-3">-->
<!--                                <div class="ui-material">-->
<!--                                    <p:outputLabel for="profile_id" value="#{PP_APPROVEDOCUMENT.profile_id}"/>-->
<!--                                    <p:selectOneMenu maxlength="22" id="profile_id"-->
<!--                                                     value="#{approveDocumentController.mProfileID}">-->
<!--                                        <f:selectItem itemLabel="&#45;&#45;Tất cả&#45;&#45;" itemValue=""/>-->
<!--                                        <f:selectItems value="#{approveDocumentController.mlistProfilePartner}"-->
<!--                                                       var="it"-->
<!--                                                       itemLabel="#{it.code}" itemValue="#{it.profileID}"/>-->
<!--                                    </p:selectOneMenu>-->
<!--                                    <p:message for="profile_id"/>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <div class="ui-g-12 ui-md-6 ui-lg-6">-->
<!--                                <div class="ui-material">-->
<!--                                    <p:outputLabel for="profile_id" value="#{PP_APPROVEDOCUMENT.profile_id}"/>-->
<!--                                    <p:inputText id="profile_id" style="cursor: pointer" onclick="PF('dialogPickListProfilePartner').show();" value="#{approveDocumentController.strProfileIdList}">-->
<!--                                        <p:keyFilter regEx="/[]/i"/>-->
<!--                                    </p:inputText>-->
<!--                                    <p:message for="profile_id"/>-->
<!--                                </div>-->
<!--                            </div>-->
                            <div class="ui-g-12 ui-md-6 ui-lg-6">
                                <div class="ui-material">
                                    <p:outputLabel for="profile_id" value="#{PP_APPROVEDOCUMENT.profile_id}"/>
                                    <p:selectCheckboxMenu id="profile_id" value="#{approveDocumentController.mSelectedProfilePartner2}" style="min-width: 15rem"
                                                          multiple="true" filter="true" filterMatchMode="startsWith" panelStyle="width: 30rem" scrollHeight="250">
                                        <f:selectItems value="#{approveDocumentController.mlistProfilePartner}" var="it"
                                                       itemLabel="#{it.code}" itemValue="#{it}"/>
                                    </p:selectCheckboxMenu>
                                </div>
                            </div>
                            <!--                            SELECT CYCLE -->
                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <div class="ui-material">
                                    <p:outputLabel for="cycle_date" value="#{PP_SOURCEDATA.cycle_date}"/>
                                    <p:selectOneMenu maxlength="22" id="cycle_date"
                                                     value="#{approveDocumentController.cycleDate}">
                                        <f:selectItem itemLabel="-------" itemValue=""/>
                                        <f:selectItem itemLabel="--N+1--" itemValue="0"/>
                                        <f:selectItem itemLabel="--N+7--" itemValue="2"/>
                                        <f:selectItem itemLabel="--N+30--" itemValue="1"/>
                                    </p:selectOneMenu>
                                </div>
                            </div>
                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <div class="material">
                                    <p:outputLabel for="start_date" value="#{PP_COMMONS.sta_date}"/>
                                    <p:calendar value="#{approveDocumentController.mdStartDate}" pattern="dd/MM/yyyy"
                                                mask="true" id="start_date" mode="popup" navigator="true"
                                                required="true"
                                                requiredMessage="#{PP_COMMONS.sta_date}#{PP_COMMONS.can_not_be_empty}"/>
                                    <p:message for="start_date"/>
                                </div>
                            </div>
                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <div class="material">
                                    <p:outputLabel for="end_date" value="#{PP_COMMONS.end_date}"/>
                                    <p:calendar value="#{approveDocumentController.mdEndDate}" pattern="dd/MM/yyyy"
                                                mask="true" id="end_date" mode="popup" navigator="true" required="true"
                                                requiredMessage="#{PP_COMMONS.end_date}#{PP_COMMONS.can_not_be_empty}"/>
                                    <p:message for="end_date"/>
                                    <o:validateOrder type="lte" components="start_date end_date"
                                                     message="#{PP_COMMONS.sta_end_date_error}"
                                                     showMessageFor="start_date"/>
                                </div>
                            </div>
                        </div>
                    </h:panelGroup>
                </p:panel>

                <h:panelGroup id="pnl_control">
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-12 ui-lg-5"></div>
                        <div class="ui-g-12 ui-md-12 ui-lg-2">
                            <p:commandButton process="@this :form_main:panel_filter_options" id="btn_search"
                                             actionListener="#{approveDocumentController.handleSearch}"
                                             update="panel_filter_options, table_app, pnl_control"
                                             value="#{PP_LOGCHANGE.search}" icon="fa fa-search"
                                             styleClass="btn-primary" style="width: auto;"
                                             oncomplete="clearFilters('tableApp');"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-2">
                            <p:commandButton id="btn_cancel" rendered="#{approveDocumentController.isDisplayBtnConfirm}"
                                             actionListener="#{approveDocumentController.handleCancel()}" process="@this"
                                             value="#{PP_COMMONS.back}" update="panel_center" icon="fa fa-undo">
                                <p:resetInput target="panel_filter_options"/>
                            </p:commandButton>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-5">
                        </div>
                    </div>
                </h:panelGroup>

                <div class="grid-padding">
                    <p:panel
                            header="#{PP_APPROVEDOCUMENT.app_list}"
                             styleClass="box-info"
                             rendered="#{not approveDocumentController.isDisplayBtnConfirm}">

                        <p:dataTable paginatorPosition="bottom" paginatorAlwaysVisible="true"
                                id="table_app" widgetVar="tableApp" value="#{approveDocumentController.mlistApp}"
                                     var="app"
                                     emptyMessage="#{PP_COMMONS.empty_message}"
                                     disabledSelection="#{approveDocumentController.isDisplayBtnConfirm}"
                                     rowKey="#{app.approve_id}"
                                     selection="#{approveDocumentController.mselectedApp}" rowSelectMode="checkbox"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15,20,#{approveDocumentController.mlistApp.size()}" paginator="true" rows="10" styleClass="material no-border"
                                     tableStyle="table-layout: auto;" resizableColumns="true">

                            <p:ajax global="false" event="rowSelectCheckbox" process="table_app"
                                    update=":form_main:pnl_control"/>
                            <p:ajax global="false" event="rowUnselectCheckbox" process="table_app"
                                    update=":form_main:pnl_control"/>
                            <p:ajax global="false" event="toggleSelect" process="table_app"
                                    update=":form_main:pnl_control"/>
                            <p:ajax global="false" event="filter" ignoreAutoUpdate="true"/>
                            <p:ajax global="false" event="sort"/>
                            <p:ajax global="false" event="page"/>

                            <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                            <p:column headerText="#{PP_APPROVEDOCUMENT.approve_id}">#{app.approve_id}</p:column>

                            <p:column headerText="#{PP_APPROVEDOCUMENT.name}">#{app.name}</p:column>

                            <p:column headerText="#{PP_APPROVEDOCUMENT.profile_id}">
                                #{approveDocumentController.getProfileCode(app.profile_id)}</p:column>

                            <p:column headerText="#{PP_APPROVEDOCUMENT.pdf_document}" width="80"
                                      style="text-align: center !important;">
                                <p:commandLink id="pdf_document" rendered="#{approveDocumentController.isAllowUpdate}"
                                               actionListener="#{approveDocumentController.handlePdf(app)}"
                                               process="@this" styleClass="fa fa-eye"
                                               update=":form_main:panel_center">
                                </p:commandLink>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <p:tooltip for="pdf_document" value="#{PP_APPROVEDOCUMENT.pdf_document}"/>

                                <p:commandLink id="pdf_download" ajax="false" type="application/pdf"
                                               onclick="PrimeFaces.monitorDownload(downloadStart, downloadStop);"
                                               styleClass="fa fa-download">
                                    <p:fileDownload value="#{approveDocumentController.downloadPdf(app)}" contentDisposition="attachment"/>
                                </p:commandLink>
                                <p:tooltip for="pdf_download" value="#{PP_APPROVEDOCUMENT.pdf_download}"/>
                            </p:column>

                            <p:column headerText="#{PP_APPROVEDOCUMENT.excel_document}" width="80"
                                      style="text-align: center !important;">
                                <p:commandLink id="excel_document" rendered="#{approveDocumentController.isAllowUpdate}"
                                               actionListener="#{approveDocumentController.handleExcel(app)}"
                                               process="@this" styleClass="fa fa-eye"
                                               update=":form_main:panel_center">
                                </p:commandLink>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <p:tooltip for="excel_document" value="#{PP_APPROVEDOCUMENT.excel_document}"/>

                                <p:commandLink id="excel_download" ajax="false" type="application/xlsx"
                                               onclick="PrimeFaces.monitorDownload(downloadStart, downloadStop);"
                                               styleClass="fa fa-download">
                                    <p:fileDownload value="#{approveDocumentController.downloadExcel(app)}" contentDisposition="attachment"/>
                                </p:commandLink>
                                <p:tooltip for="excel_download" value="#{PP_APPROVEDOCUMENT.excel_download}"/>
                            </p:column>
                            <p:column headerText="#{PP_APPROVEDOCUMENT.create_datetime}">#{func:getDateTimeStr(app.create_datetime)}</p:column>
                            <p:column headerText="#{PP_APPROVEDOCUMENT.from_date}">#{func:getDateTimeStr(app.from_date)}</p:column>
                            <p:column headerText="#{PP_APPROVEDOCUMENT.to_date}">#{func:getDateTimeStr(app.to_date)}</p:column>

<!--                            Approve status - Trang thai phe duyet column-->
                            <p:column headerText="#{PP_APPROVEDOCUMENT.approve_status}" width="240"
                                      style="text-align: center !important;">
                                <p:commandLink id="aprrove_c1" rendered="true"
                                               disabled="#{approveDocumentController.checkApproveDisable(0, app)}"
                                               styleClass="#{approveDocumentController.getApproveStyle(0, app)}">
                                </p:commandLink>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <p:tooltip for="aprrove_c1"
                                           value="#{approveDocumentController.checkApproveStatus(0, app)}"/>

                                <p:commandLink id="aprrove_c2" rendered="true"
                                               disabled="#{approveDocumentController.checkApproveDisable(1, app)}"
                                               styleClass="#{approveDocumentController.getApproveStyle(1, app)}">
                                </p:commandLink>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <p:tooltip for="aprrove_c2"
                                           value="#{approveDocumentController.checkApproveStatus(1, app)}"/>

                                <p:commandLink id="aprrove_c3" rendered="true"
                                               disabled="#{approveDocumentController.checkApproveDisable(2, app)}"
                                               styleClass="#{approveDocumentController.getApproveStyle(2, app)}">
                                </p:commandLink>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <p:tooltip for="aprrove_c3"
                                           value="#{approveDocumentController.checkApproveStatus(2, app)}"/>

                                <p:commandLink id="aprrove_c4" rendered="true"
                                               disabled="#{approveDocumentController.checkApproveDisable(3, app)}"
                                               styleClass="#{approveDocumentController.getApproveStyle(3, app)}">
                                </p:commandLink>
                                <p:tooltip for="aprrove_c4"
                                           value="#{approveDocumentController.checkApproveStatus(3, app)}"/>
                            </p:column>

<!--                            Trang thai - Status column -->
                            <p:column headerText="#{PP_APPROVEDOCUMENT.status}">
                                <h:outputText styleClass="label label-warning" rendered="#{app.status ne '4'}"
                                              value="#{approveDocumentController.getStatus(app.status)}"/>
                                <h:outputText styleClass="label label-success" rendered="#{app.status eq '4'}"
                                              value="#{approveDocumentController.getStatus(app.status)}"/>
                            </p:column>
                            <p:column headerText="#{PP_APPROVEDOCUMENT.approve}" width="80"
                                      style="text-align: center !important;">
                                <p:commandLink id="btn_edit" rendered="#{approveDocumentController.isAllowInsert}"
                                               disabled="#{not approveDocumentController.checkApprove(app.status)}"
                                               actionListener="#{approveDocumentController.handleApprove(app)}"
                                               process="@this" styleClass="#{approveDocumentController.getApprovedStyle(app.status)}"
                                               value="#{approveDocumentController.getHeaderApprove(app.status)}"
                                               update=":form_main:panel_center">
                                    <p:confirm header="#{PP_APPROVEDOCUMENT.approve_dialog_header}"
                                               message="#{PP_APPROVEDOCUMENT.confirm_approve}"/>
                                </p:commandLink>
                                <p:tooltip for="btn_edit" value="#{PP_APPROVEDOCUMENT.approve}"/>
                            </p:column>
                        </p:dataTable>
                    </p:panel>

                    <p:panel header="#{PP_APPROVEDOCUMENT.app_info}" styleClass="box-primary"
                             rendered="#{approveDocumentController.isDisplayBtnConfirm}">
                        <p:focus context=":form_main:panel_add_app"/>
                        <h:panelGroup id="panel_add_app">
                            <p:media rendered="#{approveDocumentController.show}" value="/#{approveDocumentController.mstrFileName}" width="100%" height="560px">
                                Your browser can't display pdf, <h:outputLink
                                    value="#{request.contextPath}/#{approveDocumentController.mstrFileName}">click</h:outputLink> to download pdf instead.
                            </p:media>
                            <p:lightBox rendered="#{not approveDocumentController.show}" iframe="true" id="lighbox3">
                                <iframe onload="javascript:resizeIframe(this);" id="frame" src="#{request.contextPath}/#{approveDocumentController.mstrFileName}" style="width: 100%; margin-top: 20px; overflow: hidden;" frameborder="0"></iframe>
                            </p:lightBox>
                        </h:panelGroup>
                    </p:panel>

                </div>
            </h:panelGroup>
            <p:dialog id="dialog_pick_profile_id" widgetVar="dialogPickListProfilePartner" header="#{PP_MNGGROUP.pick_list_profile}" modal="true" resizable="false" draggable="true" closeOnEscape="true" styleClass="box-info" responsive="true" style="max-width: 600px">
                <p:dataTable paginatorPosition="top" id="table_pick_profile_id" widgetVar="tablePickProfileId" paginator="true" rowSelectMode="checkbox"
                             value="#{approveDocumentController.mlistProfilePartner}" var="pickProfileIdItem" emptyMessage="#{PP_COMMONS.empty_message}"
                             rowKey="#{pickProfileIdItem.profileID}" selection="#{approveDocumentController.mSelectedProfilePartner}"
                             rows="8" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink}"
                             styleClass="no-border"
                >

                    <p:ajax global="false" event="filter" ignoreAutoUpdate="true"/>
                    <p:ajax global="false" event="sort"/>
                    <p:ajax global="false" event="page"/>

                    <p:column selectionMode="multiple" headerText="&nbsp;"/>

                    <p:column headerText="#{PP_MNGGROUP.name_partner}" filterBy="#{pickProfileIdItem.code}" filterMatchMode="contains">
                        <div class="icon-level left">
                            #{pickProfileIdItem.code}
                        </div>
                        <div class="clear"/>
                    </p:column>
                </p:dataTable>

                <div style="margin-top: 5px;">
                    <p:panelGrid layout="grid" columns="2" styleClass="ui-panelgrid-blank">
                        <p:commandButton process="@this :form_main:table_pick_profile_id" update="profile_id" oncomplete="PF('dialogPickListProfilePartner').hide();" value="#{PP_COMMONS.ok}" styleClass="btn-success" icon="fa fa-check-circle" resetValues="true"/>
                        <p:commandButton value="#{PP_COMMONS.back}" type="button" onclick="PF('dialogPickListProfilePartner').hide();" icon="fa fa-undo" styleClass="back "/>
                    </p:panelGrid>
                </div>
            </p:dialog>
        </div>
    </ui:composition>
</h:body>
</html>