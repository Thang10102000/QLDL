<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      lang="vi">
<head th:replace="fragments/html-head">
    <meta charset="utf-8">
    <title>Thêm mới chiết khấu cho đại lý</title>
</head>

<body>
    <form th:action="@{/new-agency-discount}" method="post">
        <table class="table table-condensed col">
            <tr>
                <td style="width: 50%;">
                    <label for="policyName">Tên chính sách chiết khấu</label>
                    <select name="policyName" class="form-control select2" id="policyName">
                        <option value="">--Chọn chính sách--</option>
                        <option th:each="dt :${discount}" th:value="${dt.id}"
                                th:text="${dt.policyName}"></option>
                    </select>
                    <span class="required" id="policyNameMessage"></span>
                </td>
                <td></td>
            </tr>
            <tr>
                <td>
                    <label for="selectCTKV">Chọn công ty khu vực<b class="required">(*)</b></label>
                    <select name="selectCTKV" id="selectCTKV"
                            class="selectService select2 form-control " multiple>
                        <option
                                th:each="aga : ${agencyArea}"
                                th:value="${aga.areaId}"
                                th:text="${aga.areaName}"
                        ></option>

                    </select>
                </td>
                <td>
                    <input type="hidden" name="agency" class="agency" id="agency">
                    <label for="agencyDiscounts">Chọn đại lý<b
                            class="required">(*)</b></label>
                    <select name="agencyDiscounts" id="agencyDiscounts"
                            class="agencyDiscounts select2 form-control " multiple>
                    </select>
                    <span class="required" id="agencyDiscountsMessage"></span>
                </td>
            </tr>
            <tr class='control'>
                <td colspan='4' align='center'>
                    <button type="submit" class="btn btn-primary button-control" name="doNew" id="doNew"><i
                            class="fa fa-plus-square"></i>
                        Thêm mới
                    </button>
                    <a type="button" id="doBack" class="btn btn-primary button-control"
                       th:href="@{/agency-discount}"><i
                            class="fa fa-undo" aria-hidden="true"></i> Quay lại</a>
                </td>
            </tr>
        </table>
    </form>

<script src="/vasonline/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="/vasonline/style/bootstrap-datepicker.min.css">
<script src="/vasonline/js/custom_service.js"></script>
<script src="/vasonline/js/select2.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $(".select2").select2();
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active');
        });
        $("#agencyDiscounts").on("change", function (e) {
            let value = Array.from(e.target.selectedOptions, option => option.value);
            $('input:hidden[name=agency]').val(value);
            console.log($('input:hidden[name=agency]').val());
        })
        $("#selectCTKV").on("change", function (e) {
            let value = Array.from(e.target.selectedOptions, option => option.value);
            var linkPost = "/vasonline/agency-list?idAgencyArea=" + value.toString();

            $.ajax({
                url: linkPost,
                method: 'GET',
                success: function (data) {

                    var str = '';

                    for (let i = 0; i < data.length; i++) {
                        str += ' <option value= "' + data[i].id + '" >' + data[i].agencyName + '</option>'
                    }
                    $('#agencyDiscounts').html(str);

                },
                error: function (request) {
                    alert("The request failed: " + request.responseText);
                }
            });
        })
        $("#policyName, #agencyDiscounts").keydown(function () {
            $("#policyNameMessage, #agencyDiscountsMessage").text("");
        })
    });
    $("#doNew").on('click', function (e) {
        if ($("#policyName").val() === '') {
            $("#policyNameMessage").text("Bạn chưa chọn tên chính sách");
            return false;
        }
        if ($("#agencyDiscounts").val() === '') {
            $("#agencyDiscountsMessage").text("Bạn chưa nhập đại lý");
            return false;
        }
        return true;
    })
</script>
</body>

</html>