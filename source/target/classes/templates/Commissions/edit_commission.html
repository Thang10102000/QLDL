<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      lang="vi">
<head th:replace="fragments/html-head">
    <link rel="stylesheet" href="/style/select2.min.css">
    <link rel="stylesheet" href="/style/datepicker3.css">
    <meta charset="utf-8">
    <title>Chỉnh sửa chính sách hoa hồng</title>
</head>

<body>
    <form th:action="@{/edit-commission}" method="post" th:object="${commission}">
        <table class="table table-condensed col">
            <tr>
                <td>
                    <label for="policyName">Tên chính sách<b class="required">(*)</b></label>
                    <input type="text" name="policyName" th:field="*{policyName}" class="form-control"
                           placeholder="Tên chính sách"
                           id="policyName" autocomplete="off">
                    <span class="required" id="policyNameMessage"></span>
                </td>
                <td>
                    <label for="description">Mô tả chính sách </label>
                    <input type="text" name="description" class="form-control" th:field="*{description}"
                           placeholder="Mô tả chính sách" id="description" autocomplete="off">
                </td>
            </tr>
            <tr>
                <td>
                    <label for="startDate">Ngày bắt đầu<b class="required">(*)</b></label>
                    <input type="text" name="startDate" class="form-control" th:field="*{startDate}"
                           placeholder="Ngày bắt đầu"
                           id="startDate" autocomplete="off">
                    <span class="required" id="startDateMessage"></span>
                </td>
                <td>
                    <label for="endDate">Ngày kết thúc<b class="required">(*)</b></label>
                    <input type="text" name="endDate" class="form-control" th:field="*{endDate}"
                           placeholder="Ngày kết thúc"
                           id="endDate" autocomplete="off">
                    <span class="required" id="endDateMessage"></span>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="commissionRate">Tỷ lệ hoa hồng(%) <b class="required">(*)</b></label>
                    <input type="number" name="rate" class="form-control sss"
                           placeholder="Tỷ lệ hoa hồng" id="commissionRate" th:field="*{rate}"
                           autocomplete="off">
                    <span class="required" id="commisionRateMessage"></span>
                </td>
                <td>
                    <input type="checkbox" id="isDefault" name="isDefault" th:checked="*{isDefault} == 1"> Chính sách mặc định
                    <input type="hidden" id="checkDefault" name="checkDefault">
                    <input type="hidden" id="id" name="id" th:field="*{id}">
                </td>
            </tr>
            <tr class='control'>
                <td colspan='4' align='center'>
                    <button class="btn btn-primary button-control" type="submit" name="doEdit" id="doEdit">
                        <i class="fa fa-pencil" aria-hidden="true"></i>
                        Chỉnh sửa
                    </button>
                    <button type="button" id="doBack" class="btn btn-primary button-control"  data-dismiss="modal"><i
                            class="fa fa-undo" aria-hidden="true"></i> Quay lại</button>
                </td>
            </tr>
        </table>
    </form>

<script src="/vasonline/js/select2.min.js"></script>
<script src="/vasonline/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="/vasonline/style/bootstrap-datepicker.min.css">
<script src="/vasonline/js/custom_service.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $(".select2").select2();
        $(".notAllBrand").removeAttr('hidden');

        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active');
        });
        $("#startDate").datepicker({
            format: "dd/mm/yyyy",
            startDate: 'today',
            todayHighlight: true
        });
        $("#endDate").datepicker({
            format: "dd/mm/yyyy",
            startDate: 'today',
            todayHighlight: true,
            inline: true
        });
        $("#policyName, #commisionRate").keydown(function () {
            $("#policyNameMessage, #commisionRateMessage").text("");
        });
    });
    $("#startDate, #endDate").on("change",function (){
        $(" #startDateMessage, #endDateMessage").text("");
    });
    $(':checkbox').change(function () {
        if($('#isDefault').prop('checked')){
            $("#checkDefault").val("1");
        }else {
            $("#checkDefault").val("");
        }
    });
    $(document).on('click',"#doEdit", function (e) {
        var format3 = /[`!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/;
        if (format3.test($("#policyName").val())) {
            $("#policyNameMessage").text("Tên chính sách chứa ký tự đặc biệt");
            $("#policyName").focus();
            return false;
        }
        if ($("#policyName").val() === '') {
            $("#policyNameMessage").text("Bạn chưa nhập tên chính sách");
            $("#policyName").focus();
            return false;
        }
        if ($("#commissionRate").val() === '') {
            $("#commisionRateMessage").text("Bạn chưa nhập tỷ lệ hoa hồng");
            $("#commissionRate").focus();
            return false;
        }
        if ($("#startDate").val() === '') {
            $("#startDateMessage").text("Bạn chưa nhập ngày bắt đầu");
            $("#startDate").focus();
            return false;
        }
        if ($("#endDate").val() === '') {
            $("#endDateMessage").text("Bạn chưa nhập ngày bắt đầu");
            $("#endDate").focus();
            return false;
        }
        //	check end date > start date
        var ngaybatdau = $('#startDate').val();
        var ngayketthuc = $('#endDate').val();
        ngaybatdau = parseDate(ngaybatdau).getTime();
        ngayketthuc = parseDate(ngayketthuc).getTime();

        if (ngaybatdau > ngayketthuc) {
            $('#endDateMessage').text('Vui lòng nhập ngày kết thúc lớn hơn ngày bắt đầu!');
            return false;
        }

        if ($("#commisionRate").val()*1 < 0 || $("#commisionRate").val()*1 > 100) {
            $("#commisionRateMessage").text("Tỷ lệ hoa hồng phải lớn hơn bằng 0 và nhỏ hơn bằng 100");
            return false;
        }
    })
    var invalidChars = ["-", "+", "e", ","];
    $("#commisionRate").on("keydown", function (e) {
        if (invalidChars.includes(e.key)) {
            e.preventDefault();
        }
    });
</script>
</body>

</html>
