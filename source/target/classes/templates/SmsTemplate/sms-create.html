<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	  lang="vi">
<head th:replace="fragments/html-head">
	<meta charset="utf-8">
	<title>Quản lý mẫu tin nhắn</title>
</head>
<body>
<input type="hidden" th:name="${_csrf.parameterName}"
	   th:value="${_csrf.token}" />
<div class="wrapper" sec:authorize="isAuthenticated()">
			<div class="box box-primary table-responsive" id="formSms"
				 sec:authorize="hasAuthority('Quản lý tài khoản:Xem')">
				<form th:action="@{/admin/sms-management/create}" method='POST' id="form">
					<table class="table table-sm newSms" id="smstable">
						<tr>
							<td><label for="shortCode">Tên mẫu<b class="required">(*)</b></label>
									<input
											type="text" class="form-control" placeholder="Short code"
											name="shortCode" id="shortCode" autocomplete="off">
									<span id="messageShortcode" class="required"></span>
							</td>
							<td><label for="status">Trạng thái<b class="required">(*)</b></label>
								<select
									name="status" id="status" class="form-control">
								<option value="1">Hiệu lực</option>
								<option value="0">Không hiệu lực</option>
							</select>
							</td>
						</tr>
						<tr>
							<td><label for="startDate">Ngày bắt đầu<b class="required">(*)</b></label>
									<input type="text" class="form-control"
										   placeholder="Start date" name="startDate" id="startDate" autocomplete="off">
									<span id="messageStartdate" class="required"></span>
							</td>
							<td><label for="endDate">Ngày kết thúc<b class="required">(*)</b></label>
									<input type="text" class="form-control" placeholder="End date"
										   name="endDate" id="endDate" autocomplete="off">
									<span id="messageEnddate" class="required"></span>
								</td>
						</tr>
						<tr>
							<td><label for="smsDescription">Mô tả</label>
								<textarea
									class="form-control" placeholder="Description"
									name="smsDescription" id="smsDescription" autocomplete="off"></textarea>
								</td>
							<td><label for="smsContent">Nội dung<b class="required">(*)</b></label>
								<textarea class="form-control" placeholder="Content" name="smsContent" id="smsContent" autocomplete="off"></textarea>
									<span id="messageContent" class="required"></span>
							</td>

						</tr>
						<tr class='control'>
							<td colspan='4' align='center'>
								<button class="btn btn-primary button-control" id="doNew"
										type="submit" >
									<i class="fa fa-plus-square"></i> THÊM MỚI
								</button>&nbsp; <a class="btn btn-primary button-control"
												   th:href="@{/admin/sms-management}" id="goBack"> <i
									class="fa fa-undo"></i> QUAY LẠI
							</a>&nbsp;
							</td>
						</tr>
					</table>
				</form>
			</div>
</div>
<link rel="stylesheet" href="/vasonline/style/bootstrap-datepicker.min.css">
<script src="/vasonline/js/bootstrap-datepicker.min.js"></script>
<script src="/vasonline/js/custom_service.js"></script>
<script src="/vasonline/js/sms-search.js"></script>
<script src="/vasonline/js/validator.js"></script>
<script type="text/javascript">

	$(document).ready(function() {
		$('#sidebarCollapse').on('click', function () {
			$('#sidebar').toggleClass('active');
		});
		$("#shortCode, #startDate, #endDate, #smsContent").keydown(function () {
			$("#messageShortcode").text("");
			$("#messageStartdate").text("");
			$("#messageEnddate").text("");
			$("#messageContent").text("");
		})
	});
	$('#form').submit(function(){
		$("#doNew", this)
				.html("Đang xử lý...")
				.attr('disabled', 'disabled');
		return true;
	});
	$(document).on('click',"#doNew", function (e) {
		// var format = /[`!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/;
		// if (format.test($("#shortCode").val())) {
		// 	$("#messageShortcode").text("Mã tin nhắn chứa ký tự đặc biệt");
		// 	$("#shortCode").focus();
		// 	return false;
		// }
			if ($("#shortCode").val().trim() === '') {
			$("#messageShortcode").text("Bạn chưa nhập mã tin nhắn");
			$("#shortCode").focus();
			return false;
		}
		if ($("#startDate").val().trim() === '') {
			$("#messageStartdate").text("Bạn chưa nhập ngày bắt đầu");
			$("#startDate").focus();
			return false;
		}
		if ($("#endDate").val().trim() === '') {
			$("#messageEnddate").text(
					"Bạn chưa nhập ngày kết thúc");
			$("#endDate").focus();
			return false;
		}
		if ($("#smsContent").val().trim() === '') {
			$("#messageContent").text(
					"Bạn chưa nhập nội dung tin nhắn");
			$("#smsContent").focus();
			return false;
		}
		var s = $.trim($('#startDate').val()).split('/');
		var e = $.trim($('#endDate').val()).split('/');
		console.log(s)

		if (!(parseInt(e[2]) > parseInt(s[2]) || (parseInt(e[2]) === parseInt(s[2]) && parseInt(e[1]) > parseInt(s[1])) || (parseInt(e[2]) === parseInt(s[2]) && parseInt(e[1]) === parseInt(s[1]) && parseInt(e[0]) > parseInt(s[0])))) {
			$("#messageEnddate").text("Bạn phải nhập ngày kết thúc lớn hơn ngày bắt đầu")
			$("#endDate").focus();
			return false;
		}

	});
	$("#startDate").datepicker({
		format : "dd/mm/yyyy",
		todayHighlight : true,
		inline : true
	});
	$("#endDate").datepicker({
		format : "dd/mm/yyyy",
		todayHighlight : true,
		inline : true
	});

	var invalidChars = [ "-", "+", "e", ",", "."," " ];
	$("#shortCode").on("keydown", function(e) {
		if (invalidChars.includes(e.key)) {
			e.preventDefault();
		}
	});


</script>
</body>

</html>