<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	lang="vi">
<head th:replace="fragments/html-head">
<meta charset="utf-8">
<title>Chi tiết chính sách chiết khấu</title>
</head>

<body>
	<div class="tab-base">
		<ul class="nav nav-tabs">
			<li class="nav-item">
				<a class="nav-link active" data-target="#tab" data-toggle="tab">Đại lý thuộc chính sách</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" data-toggle="tab" data-target="#tab1">Thêm mới Đại lý thuộc chính sách</a>
			</li>
		</ul>
	</div>
	<div class="tab-content">
		<div id="tab" class="tab-pane fade active in show">
			<form>
				<table class="table table-condensed col">
					<tr>
						<td style="width: 50%;">
							<label for="policyName1">Tên chính sách chiết khấu</label>
							<select name="policyName1" class="form-control select2" id="policyName1">
								<option value="">--Chọn chính sách--</option>
								<option th:each="dt :${discount}" th:value="${dt.id}"
										th:text="${dt.policyName}" th:selected="${policyId} == ${dt.id}"></option>
							</select>
						</td>
						<td>
							<label for="agencyName">Đại lý</label>
							<select name="agencyName" class="form-control select2" id="agencyName">
								<option value="">--Chọn đại lý--</option>
								<option th:each="ag :${agency}" th:value="${ag.id}"
										th:text="${ag.agencyName}"></option>
							</select>
						</td>
					</tr>
					<tr class='control'>
						<td colspan='4' align='center'>
							<button type="button" class="btn btn-primary button-control"
									name="doSearchDetail" id="doSearchDetail">
								<i class="fa fa-search"></i> Tìm kiếm
							</button>
						</td>
					</tr>
				</table>
			</form>
			<div class="list-service box box-primary">
				<table class="table table-bordered">
					<thead>
					<tr align="center">
						<th>Tên CTKV</th>
						<th>Tên đại lý</th>
						<th>Tên chính sách</th>
						<th>Hành động</th>
					</tr>
					</thead>
					<tbody id="tableBody1"></tbody>
				</table>
				<nav aria-label="Page navigation">
					<ul class="pagination">
						<li class="page-item"><span id="totalPage1"></span></li>
						<li class="page-item"><span id="pageSize1"></span></li>
						<li class="page-item">
							<div class="form-group">
								<select class="form-control" name="selector"
										onChange="resetPage1()">
									<option>10</option>
									<option>20</option>
									<option>50</option>
									<option>100</option>
									<option>200</option>
								</select>
							</div>
						</li>
						<li class="page-item"><span>&nbsp;</span></li>
						<li class="page-item"><a class="page-link"
												 onClick="firstPage1()"><i class="fa fa-angle-double-left"></i></a></li>
						<li class="page-item"><a class="page-link"
												 onClick="prevPage1()"><i class="fa fa-angle-left"></i></a></li>
						<li class="page-item"><a id="prePage"></a></li>
						<li class="page-item"><a class="page-link" id="currentPage1">1</a></li>
						<li class="page-item"><a id="nexPage"></a></li>
						<li class="page-item"><a class="page-link"
												 onClick="nextPage1()"><i class="fa fa-angle-right"></i></a></li>
						<li class="page-item"><a class="page-link"
												 onClick="lastPage1()"><i class="fa fa-angle-double-right"></i></a></li>
					</ul>
				</nav>
			</div>
		</div>
		<div id="tab1" class="tab-pane fade">
			<form th:action="@{/new-agency-discount}" method="post">
				<table class="table table-condensed col">
					<tr>
						<td style="width: 50%;">
							<label for="policyName2">Tên chính sách chiết khấu</label>
							<select name="policyName2" class="form-control select2" id="policyName2">
								<option value="">--Chọn chính sách--</option>
								<option th:each="dt :${discount}" th:value="${dt.id}"
										th:text="${dt.policyName}" th:selected="${policyId} == ${dt.id}"></option>
							</select>
							<span class="required" id="policyNameMessage"></span>
						</td>
						<td></td>
					</tr>
					<tr>
						<td>
							<label for="selectCTKV">Chọn công ty khu vực<b class="required">(*)</b></label>
							<select name="selectCTKV" id="selectCTKV"
									class="selectService select2 form-control " multiple>
								<option
										th:each="aga : ${agencyArea}"
										th:value="${aga.areaId}"
										th:text="${aga.areaName}"
								></option>

							</select>
						</td>
						<td>
							<input type="hidden" name="agency" class="agency" id="agency">
							<label for="agencyDiscounts">Chọn đại lý<b
									class="required">(*)</b></label>
							<select name="agencyDiscounts" id="agencyDiscounts"
									class="agencyDiscounts select2 form-control " multiple>
							</select>
							<span class="required" id="agencyDiscountsMessage"></span>
						</td>
					</tr>
					<tr class='control'>
						<td colspan='4' align='center'>
							<button type="submit" class="btn btn-primary button-control" name="doNewAD" id="doNew"><i
									class="fa fa-plus-square"></i>
								Thêm mới
							</button>
							<button type="button" id="doBack" class="btn btn-primary button-control" data-dismiss="modal"><i
									class="fa fa-undo" aria-hidden="true"></i> Quay lại</button>
						</td>
					</tr>
				</table>
			</form>
		</div>
	</div>


	<script src="/vasonline/js/select2.min.js"></script>
	<script src="/vasonline/js/custom_service.js"></script>
	<script src="/vasonline/js/agency-discount-search.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			$(".select2").select2();
			$('#sidebarCollapse').on('click', function () {
				$('#sidebar').toggleClass('active');
			});
			$("#agencyDiscounts").on("change", function (e) {
				let value = Array.from(e.target.selectedOptions, option => option.value);
				$('input:hidden[name=agency]').val(value);
				console.log($('input:hidden[name=agency]').val());
			})
			$("#selectCTKV").on("change", function (e) {
				let value = Array.from(e.target.selectedOptions, option => option.value);
				var linkPost = "/vasonline/agency-list-no-policy?idAgencyArea=" + value.toString();

				$.ajax({
					url: linkPost,
					method: 'GET',
					success: function (data) {

						var str = '';

						for (let i = 0; i < data.length; i++) {
							str += ' <option value= "' + data[i].id + '" >' + data[i].agencyName + '</option>'
						}
						$('#agencyDiscounts').html(str);

					},
					error: function (request) {
						alert("The request failed: " + request.responseText);
					}
				});
			})
			$("#policyName2, #agencyDiscounts").keydown(function () {
				$("#policyNameMessage, #agencyDiscountsMessage").text("");
			})
		});
		$("#doNewAD").on('click', function (e) {
			if ($("#policyName2").val() === '') {
				$("#policyNameMessage").text("Bạn chưa chọn tên chính sách");
				return false;
			}
			if ($("#agencyDiscounts").val() === '') {
				$("#agencyDiscountsMessage").text("Bạn chưa nhập đại lý");
				return false;
			}
			return true;
		})
	</script>
</body>

</html>