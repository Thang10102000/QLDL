<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      lang="vi">
<head th:replace="fragments/html-head">
    <meta charset="utf-8">
    <title>Thêm mới gói cước</title>
</head>

<body>

<form th:action="@{/new-cus}" method="post" id="form">
    <table class="table table-condensed col">
        <tr>
            <td style="width: 50%"><label for="nameCusNew">Tên khách hàng<b class="required">(*)</b></label>
                <input type="text" name="nameCus"  class="form-control" placeholder="Tên khách hàng" id="nameCusNew"
                       autocomplete="off"> <span class="required" id="messageNameCus"></span>
            </td>
            <td><label for="domain">Tên miền</label>
                <input type="text" name="domain"  class="form-control" placeholder="Tên miền" id="domain"
                       autocomplete="off"> <span class="required" id="messageDomain"></span>
            </td>
        </tr>
        <tr>
            <td s><label for="email">Email <b class="required">(*)</b></label>
                <input type="text" name="email" class="form-control" placeholder="Email" id="email"
                       autocomplete="off"> <span class="required" id="messageEmail"></span>
            </td>
            <td><label for="phone">Số điện thoại <b class="required">(*)</b></label>
                <input type="text" name="phone"  class="form-control" placeholder="Số điện thoại" id="phone"
                       autocomplete="off"> <span class="required" id="messagePhone"></span>
            </td>
        </tr>
        <tr>
            <td><label for="schoolNew">Loại trường học <b class="required">(*)</b></label>
                <select style="text-transform: capitalize" name="school" id="schoolNew" class="form-control">
                    <option value="">--Loại trường học--</option>
                    <option  th:each="lv : ${school}" th:value="${lv.id}"
                            th:text="${lv.schoolType}"></option>
                </select>
                <span class="required" id="messageSchoolNew"></span>
            </td>
            <td><label for="areaNew">Công ty khu vực - Trung tâm <b class="required">(*)</b></label>
                <select name="area" id="areaNew" class="form-control" >
                    <option th:each="lv : ${areas}" th:value="${lv.areaId}"
                            th:text="${lv.areaName}"></option>
                </select>
                <span class="required" id="messageAreaNew"></span>
            </td>
        </tr>
        <tr>
            <td><label for="agencyCodesl" >Đại lý - AM/KAM </label>
                <select name="agencyCode" id="agencyCodesl" class="form-control select2New" th:if="${agency == null}">
                    <option value="">--Chọn mã đại lý - AM/KAM--</option>
                </select>
                <select name="agencyCode" id="agencyCodesl" class="form-control select2New" th:if="${agency != null}">
<!--                    <option value="">&#45;&#45;Chọn mã đại lý - AM/KAM&#45;&#45;</option>-->
                    <option
                            th:each="ag : ${agency}"
                            th:value="${ag.agencyCode}"
                            th:text=" ${ag.agencyCode} +'-'+ ${ag.agencyName}"
                    ></option>
                </select>
                <span class="required" id="messageAgencyCodesl"></span>
            </td>
<!--            <td><label for="amCode" >Mã AM-KAM</label>-->
<!--                <select name="amCode" id="amCode" class="form-control">-->
<!--                    <option value="">&#45;&#45;Chọn mã AM-KAM&#45;&#45;</option>-->
<!--                </select>-->
<!--            </td>-->
            <td><label for="province">Tỉnh thành<b class="required">(*)</b></label>
                <select id="province" name="province" class="form-control">
                    <option value="">Chọn tỉnh, thành phố</option>
                    <option th:each="province : ${listProvince}"
                            th:value="${province.id}" th:text="${province.province_name}"></option>
                </select>
                <span class="required" id="messageProvince"></span>
            </td>
        </tr>
        <tr>
            <td><label for="district">Quận/Huyện<b class="required">(*)</b></label>
                <select id="district" name="district" class="form-control">
                </select>
                <span class="required" id="messageDistrict"></span>
            </td>
            <td><label for="wards">Phường/Xã<b   class="required">(*)</b></label>
                <select id="wards" name="wards" class="form-control">
                </select>
                <span class="required" id="messageWards"></span>
            </td>
        </tr>
        <tr>
            <td><label for="addresssd">Đường/Phố</b></label>
                <input type="text" name="address"  class="form-control" placeholder="Địa Chỉ" id="addresssd"
                       autocomplete="off"> <span id="messageAddress"></span>
            </td>
            <td></td>
        </tr>
        <tr class='control'>
            <td colspan='4' align='center'>
                <button type="submit" class="btn btn-primary button-control new"
                        name="doNew" id="doNew">
                    <i class="fa fa-plus-square"></i> Thêm mới
                </button>
                <a type="button" id="doBack"
                   class="btn btn-primary button-control" data-dismiss="modal"><i
                        class="fa fa-undo" aria-hidden="true"></i> Quay lại</a>
            </td>
        </tr>
    </table>
</form>

<script src="/vasonline/js/custom_service.js"></script>
<script src="/vasonline/js/select2.min.js"></script>
<script type="text/javascript">
    $(".select2New").select2();
    $(document).on("change","#wards, #province, #district, #schoolNew, #agencyCodesl", function () {
        $("#messageWards").text("");
        $("#messageDistrict").text("");
        $("#messageProvince").text("");
        $("#messageAgencyCodesl").text("");
        $("#messageSchoolNew").text("");
    })
    $(document).ready(function () {
        $("#schoolNew , #nameCusNew, #domain, #addresssd, #email, #phone ").keydown(function () {
            $("#messageNameCus").text("");
            $("#messageAddress").text("");
            $("#messageSchool").text("");
            $("#messageDomain").text("");
            $("#messageEmail").text("");
            $("#messagePhone").text("");

        });
        if ($("#areaNew").val() != '' && $("#agencyCodesl").val() == ''){
            let linkUrl = "/vasonline/get-all-agency-by-area?areaId="+ $("#areaNew").val();
            $.ajax({
                url: linkUrl,
                method: 'GET',
                success: function (data) {
                    var str = '<option value= "">---Lựa chọn Đại lý - AM/KAM ----</option>';
                    var strAm = '<option value= "">---Lựa chọn AM/KAM----</option>'
                    for (let i = 0; i < data.length; i++) {
                        // if(data[i].type == 0){
                            str += ' <option value= "' + data[i].agencyCode + '" >' + data[i].agencyCode + ' - ' +  data[i].agencyName + '</option>';
                        // }
                        // else {
                        //     strAm += ' <option value= "' + data[i].agencyCode + '" >' + data[i].agencyName + '</option>';
                        // }

                    }
                    $("#agencyCodesl").html(str);
                    // $("#amCode").html(strAm);
                },
                error: function (request) {
                    alert("The request failed: " + request.responseText);
                }
            });
        }
    });
        $("#areaNew").on("change", function () {
            let linkUrl = "/vasonline/get-all-agency-by-area?areaId="+ $("#areaNew").val();
            $.ajax({
                url: linkUrl,
                method: 'GET',
                success: function (data) {
                    var str = '<option value= "">---Lựa chọn Đại lý - AM/KAM ----</option>';
                    var strAm = '<option value= "">---Lựa chọn AM/KAM----</option>'
                    for (let i = 0; i < data.length; i++) {
                        // if(data[i].type == 0){
                            str += ' <option value= "' + data[i].agencyCode + '" >' + data[i].agencyCode + ' - ' +  data[i].agencyName + '</option>';
                        // }
                        // else {
                        //     strAm += ' <option value= "' + data[i].agencyCode + '" >' + data[i].agencyName + '</option>';
                        // }

                    }
                    $("#agencyCodesl").html(str);
                    // $("#amCode").html(strAm);
                },
                error: function (request) {
                    alert("The request failed: " + request.responseText);
                }
            });

          });
        $("#amCode").on("change", function () {
            if ($("#amCode").val() != "") {
                $("#agencyCodesl").attr('disabled', true);
                $("#agencyCodesl").val("");
            } else {
                $("#agencyCodesl").removeAttr('disabled', true);
            }
        });
    $("#agencyCodesl").on("change", function () {
        if ($("#agencyCodesl").val() != "") {
            $("#amCode").attr('disabled', true);
            $("#amCode").val("");
        } else {
            $("#amCode").removeAttr('disabled', true);
        }
    });
        $(document).on('click', "#doNew", function () {
            $("#provinceData").val($("#province option:selected").text())
            $("#districtData").val($("#district option:selected").text())
            $("#wardsData").val($("#wards option:selected").text())

            var format = /[`!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/;
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            var reg = new RegExp('^[a-zA-Z0-9_]*$');
            if (format.test($("#nameCusNew").val())) {
                $("#messageNameCus").text(
                    "Tên khách hàng chứa ký tự đặc biệt");
                $("#nameCusNew").focus();
                return false;
            }
            if ($("#nameCusNew").val().trim() === '' || $("#nameCusNew").val().trim().length > 100) {
                $("#messageNameCus").text(
                    "Bạn nhập tên khách hàng không hợp lệ");
                $("#nameCusNew").focus();
                return false;
            }
            if ($("#domain").val().trim().length > 30) {
                $("#messageDomain").text(
                    "Bạn nhập tên miền không hợp lệ");
                $("#domain").focus();
                return false;
            }
            if ($("#email").val().trim() === '') {
                $("#messageEmail").text(
                    "Bạn chưa nhập email");
                $("#email").focus();
                return false;
            }
            if (!re.test($("#email").val())) {
                $("#messageEmail").text("Email sai định dạng");
                $("#email").focus();
                return false;
            }
            if ($("#phone").val().trim() === '') {
                $("#messagePhone").text(
                    "Bạn chưa nhập số điện thoại");
                $("#phone").focus();
                return false;
            }
            if ($("#phone").val()*1 != $("#phone").val() || $("#phone").val().length < 8 || $("#phone").val().length > 14 ) {
                $("#messagePhone").text(
                    "Bạn nhập số điện thoại sai định dạng");
                $("#phone").focus();
                return false;
            }
            if ($("#schoolNew").val().trim() === '') {
                $("#messageSchoolNew").text(
                    "Bạn chưa nhập tên trường");
                $("#schoolNew").focus();
                return false;
            }
            if ($("#agencyCodesl").val() === ''){
                $("#messageAgencyCodesl").text("Bạn chưa chọn đại lý");
                $("#agencyCodesl").focus();
                return false;
            }
            if ($("#province").val().trim() === '') {
                $("#messageProvince").text(
                    "Bạn chọn tỉnh/thành");
                $("#province").focus();
                return false;
            }if ($("#district").val().trim() === '') {
                $("#messageDistrict").text(
                    "Bạn chưa chọn quận/huyện");
                $("#district").focus();
                return false;
            }if ($("#wards").val().trim() === '') {
                $("#messageWards").text(
                    "Bạn chưa chọn xã/phường");
                $("#wards").focus();
                return false;
            }
            // if ($("#addresssd").val().trim() === '') {
            //     $("#messageAddress").text(
            //         "Bạn chưa nhập địa chỉ");
            //     $("#addresssd").focus();
            //     return false;
            // }

        });
        $('#form').submit(function () {
            $("#doNew", this).html("Đang xử lý...").attr('disabled', 'disabled');
            return true;
        });

//        get district by province is
    $(document).on("change","#province",function () {
        let linkUrl = "/vasonline/get-district?provinceId="+ $("#province").val();
        $.ajax({
            url: linkUrl,
            method: 'GET',
            success: function(data) {

                var str ='<option value= "">---Lựa chọn Quận/Huyện----</option>';

                for (let i = 0; i < data.length ; i++) {
                    str += ' <option value= "' + data[i].id + '" >' + data[i].districtName + '</option>';
                }
                $("#district").html(str);

            },
            error: function(request) {
                alert("The request failed: " + request.responseText);
            }
        })
    });

    $(document).on("change","#district",function () {
        let linkUrl = "/vasonline/get-ward?districtId="+ $("#district").val();
        $.ajax({
            url: linkUrl,
            method: 'GET',
            success: function(data) {

                var str ='<option value= "">---Lựa chọn Phường/Xã----</option>';

                for (let i = 0; i < data.length ; i++) {
                    str += ' <option value= "' + data[i].id + '" >' + data[i].wardName + '</option>';
                }
                $("#wards").html(str);

            },
            error: function(request) {
                alert("The request failed: " + request.responseText);
            }
        })
    });
</script>
</body>

</html>